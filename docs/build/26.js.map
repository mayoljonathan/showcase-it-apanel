{"version":3,"sources":["../../src/pages/change-profile/change-profile.module.ts","../../src/pages/change-profile/change-profile.ts"],"names":[],"mappings":"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","file":"26.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ChangeProfilePage } from './change-profile';\n\nimport { IonicImageViewerModule } from 'ionic-img-viewer';\n\n@NgModule({\n  declarations: [\n    ChangeProfilePage,\n  ],\n  imports: [\n    IonicImageViewerModule,\n    IonicPageModule.forChild(ChangeProfilePage),\n  ],\n})\nexport class ChangeProfilePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/change-profile/change-profile.module.ts","import { Component,ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams,ViewController } from 'ionic-angular';\nimport { FormGroup, FormControl, FormBuilder, Validators, AbstractControl }   from '@angular/forms';\n\nimport { AppService,AdminService,UserService,CacheService,FileService } from \"../../shared/services/\";\nimport { DialogUtil } from \"../../shared/utils/\";\n\nimport { Admin } from '../../shared/models';\n\n@IonicPage()\n@Component({\n  selector: 'page-change-profile',\n  templateUrl: 'change-profile.html',\n})\nexport class ChangeProfilePage {\n\n  @ViewChild('photoUpload') photoUpload;\n\n  admin: Admin;\n\n  private form: FormGroup;\n  submitAttempt:boolean = false;\n\n  alive: boolean = true;\n\n  isUploading: boolean = false;\n  errorUpload: boolean = false;\n  progress: number= 0;\n\n  password: string = '****************';\n  passwordDirty: boolean = false;\n\n  constructor(\n    public formBuilder: FormBuilder,\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public adminService: AdminService,\n    public userService: UserService,\n    public viewCtrl: ViewController,\n    public dialogUtil: DialogUtil,\n    public cacheService: CacheService,\n    public fileService: FileService,\n  ) {\n    this.admin = new Admin();\n    this.form = new FormGroup({\n        name: new FormControl('', [Validators.required,Validators.maxLength(50)]),\n    });\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ChangeProfilePage');\n    this.adminService._getAdminData(this.cacheService.admin_uid)\n      .takeWhile(()=>this.alive)\n      .subscribe(adminData=>{\n        console.log(adminData);\n        this.admin = adminData;\n      });\n  }\n\n  onPhotoChange(event:any){\n    if (event.target.files) {\n      let filename = event.target.files[0]['name'];\n      var reader = new FileReader();\n      reader.onload = (event:any) => {\n        this.uploadPhoto(event.target.result,filename);\n      }\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  }\n  uploadPhoto(data,filename){\n    this.isUploading = true;\n    this.fileService.uploadFile('admin_photo',`admin/photo/${this.cacheService.admin_uid}`,data,filename)\n        // .takeWhile(()=>this.alive)\n        .subscribe((data:any)=>{\n          if(data.progress){\n            this.progress = data.progress;\n          }else if(data.downloadURL){\n            this.isUploading = false;\n            this.admin.photoURL = data.downloadURL;\n            this.photoUpload.nativeElement.value = '';\n            this.progress = 0;\n            this.adminService.updateProfile(this.cacheService.admin_uid, this.admin).then(()=>{\n              this.dialogUtil.showToast('Photo has been saved.', 3000, 'bottom');\n            },e=>{\n              this.dialogUtil.showToast('Error in saving the photo.', 3000, 'bottom');\n            });\n          }else if(data.error){\n            this.isUploading = false;\n            this.errorUpload = true;\n            this.progress = 0;\n            this.photoUpload.nativeElement.value = '';\n            if(data.error.code !== 'storage/canceled' || data.error.code === 'function/busy'){\n              this.errorUpload = true;\n            }\n          }\n        });\n\n  }\n\n  submitForm(form){\n    this.submitAttempt = true;\n    if(form.valid){\n      this.admin.name = form.value.name;\n      this.dialogUtil.showLoader('Updating profile.');\n      this.adminService.updateProfile(this.cacheService.admin_uid,this.admin).then(()=>{\n        this.dialogUtil.hideLoader();\n        this.dialogUtil.showToast('Profile updated successfully.', 3000, 'bottom');\n      },e=>{\n        this.dialogUtil.hideLoader();\n        this.dialogUtil.showToast(`An error has occured. ${e}`, 4000, 'bottom');\n      });\n    }\n  }\n  \n  onPasswordFocus(){\n    this.password = '';\n    this.passwordDirty = true;\n  }\n\n  updatePassword(){\n    if(this.passwordDirty){\n      if(this.password.length < 6){\n        this.dialogUtil.showToast('Password must be 6 characters above.',3000,'bottom');\n      }else{\n        this.dialogUtil.showLoader('Updating password.');\n        this.adminService.updatePassword(this.password).then((res)=>{\n          this.dialogUtil.hideLoader();\n          this.dialogUtil.showToast('Password updated successfully.',3000,'bottom');\n          this.password = '****************';\n          this.passwordDirty = false;\n        },e=>{\n          this.dialogUtil.hideLoader();\n          console.log('Need reauthentication');\n          new Promise((resolve,reject)=>{\n            let promptTitle = 'Reauthenticate needed';\n            let promptMsg = 'Please enter your old password to reauthenticate.';\n            let inputs = {\n              name: 'password',\n              placeholder: 'Enter your password',\n              type: 'password',\n            };\n            let buttons = [\n              { text: 'Cancel', handler: reject },\n              { text: 'Ok', handler: resolve },\n            ];\n            this.dialogUtil.showPrompt(promptTitle,promptMsg,inputs,buttons,'password');\n          }).then((data:any)=>{\n            if(data.password.length < 6){\n              return this.dialogUtil.showToast('Password must be 6 characters above.', 4000, 'bottom');\n            }\n            this.dialogUtil.showLoader('Authenticating user.');\n            this.adminService.reauthenticateUser(data.password).then(()=>{\n              this.dialogUtil.hideLoader();\n              this.dialogUtil.showToast('Reauthenticated! Changing your password.', 3000,'bottom');\n              this.updatePassword();\n            },e=>{\n              this.dialogUtil.hideLoader();\n              this.dialogUtil.handleErrors('Error in reauthentication. Password may not be correct.');\n            });\n          },()=>{});\n\n        });\n      }\n    }\n  }\n\n  dismiss(){\n    this.viewCtrl.dismiss();\n  }\n\n  ngOnDestroy(){\n    this.alive = false;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/change-profile/change-profile.ts"],"sourceRoot":""}